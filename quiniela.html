<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Quiniela - Liga MX</title>
  <link rel="icon" href="imagenes/logo1.png" type="image/png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik&display=swap">
  <style>
    body {
      margin: 0;
      font-family: 'Rubik', sans-serif;
      background: #f2f2f2;
      color: #333;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      color: #004aad;
      margin-bottom: 0.5rem;
    }
    .logo {
      display: block;
      margin: 0 auto 0.5rem;
      width: 80px;
    }
    #contador-tiempo {
      text-align: center;
      font-weight: bold;
      font-size: 1rem;
      color: #004aad;
      margin-bottom: 1rem;
    }
    .partido {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .equipos {
      display: flex;
      justify-content: space-around;
      width: 100%;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .equipo {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 30%;
    }
    .equipo img {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }
    .vs {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .opciones {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }
    .opciones label {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      background: #e9e9e9;
      margin: 0.3rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .opciones input[type="radio"] {
      display: none;
    }
    .opciones input[type="radio"]:checked + label {
      background: #004aad;
      color: white;
      font-weight: bold;
    }
    button {
      width: 100%;
      padding: 1rem;
      background: #004aad;
      color: white;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      margin-top: 1rem;
      cursor: pointer;
    }
    button:hover {
      background: #00327a;
    }
    #bloqueo {
      text-align: center;
      color: red;
      font-weight: bold;
      margin: 0.5rem 0 1rem;
    }
    .pago-section {
      background: #ffffff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
      margin-top: 1rem;
    }
    .pago-section p {
      margin: 0.5rem 0;
    }
    .pago-section a {
      display: inline-block;
      background: #28a745;
      color: white;
      text-decoration: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      margin: 0.5rem;
    }
    .pago-section a:hover {
      background: #1e7e34;
    }
    .pago-info {
      background: #fff3cd;
      padding: 0.7rem;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      margin-top: 0.7rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <img src="imagenes/logo1.png" alt="Logo" class="logo">
  <h1>Tu Quiniela üìù</h1>

  <div id="contador-tiempo"></div>
  <div id="bloqueo"></div>

  <form id="quiniela-form"></form>

  <button id="btn-guardar" onclick="guardarQuiniela()">Guardar Quiniela</button>
  <button onclick="window.location.href='menu.html'">‚¨ÖÔ∏è Regresar al men√∫</button>

  <div class="pago-section">
    <p>üí∞ <strong>La quiniela cuesta $100 cada una.</strong></p>
    <a href="https://maps.app.goo.gl/JSmoaiYQQLTCYzdJ7?g_st=aw" target="_blank">Pagar en efectivo (ver ubicaci√≥n)</a>
    <div class="pago-info">
      Clave: 722969010705714482<br>
      Banco: STP<br>
      Nombre: Julio Cesar Santos
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBky5T7wDukelYg3Giq_pXc4oveyfHN7go",
      authDomain: "rifaboletos-c1d0d.firebaseapp.com",
      projectId: "rifaboletos-c1d0d",
      storageBucket: "rifaboletos-c1d0d.appspot.com",
      messagingSenderId: "27051588350",
      appId: "1:27051588350:web:74559bf1d4fd5a67f603af"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("quiniela-form");
    const bloqueoDiv = document.getElementById("bloqueo");
    const contadorDiv = document.getElementById("contador-tiempo");
    const btnGuardar = document.getElementById("btn-guardar");

    const partidos = [
      { local: "america", visitante: "tigres" },
      { local: "pumas", visitante: "monterrey" },
      { local: "toluca", visitante: "leon" },
      { local: "atlas", visitante: "santos" },
      { local: "cruzazul", visitante: "necaxa" },
      { local: "chivas", visitante: "queretaro" },
      { local: "mazatlan", visitante: "puebla" },
      { local: "sanluis", visitante: "xolos" },
      { local: "juarez", visitante: "pachuca" },
      { local: "real-madrid", visitante: "manchester-city" }
    ];

    partidos.forEach((p, i) => {
      form.innerHTML += `
        <div class="partido">
          <div class="equipos">
            <div class="equipo">
              <img src="imagenes/${p.local}.png" alt="${p.local}" />
              <span>${p.local.toUpperCase().replace(/-/g, " ")}</span>
            </div>
            <div class="vs">vs</div>
            <div class="equipo">
              <img src="imagenes/${p.visitante}.png" alt="${p.visitante}" />
              <span>${p.visitante.toUpperCase().replace(/-/g, " ")}</span>
            </div>
          </div>
          <div class="opciones">
            <input type="radio" name="partido${i}" id="local${i}" value="local" />
            <label for="local${i}">Gana ${p.local.toUpperCase().replace(/-/g, " ")}</label>

            <input type="radio" name="partido${i}" id="empate${i}" value="empate" />
            <label for="empate${i}">Empate</label>

            <input type="radio" name="partido${i}" id="visitante${i}" value="visitante" />
            <label for="visitante${i}">Gana ${p.visitante.toUpperCase().replace(/-/g, " ")}</label>
          </div>
        </div>
      `;
    });

    function actualizarContadores() {
      const ahora = new Date();
      const dia = ahora.getDay();
      const hora = ahora.getHours();
      const minutos = ahora.getMinutes();

      const bloqueado = (
        (dia === 5 && hora >= 17) || dia === 6 || dia === 0 || (dia === 1 && hora < 17)
      );

      let proximo = new Date();
      if (bloqueado) {
        if (dia === 5 && hora >= 17) proximo.setDate(proximo.getDate() + 3);
        else if (dia === 6) proximo.setDate(proximo.getDate() + 2);
        else if (dia === 0) proximo.setDate(proximo.getDate() + 1);
        else if (dia === 1) proximo.setHours(17, 0, 0, 0);
        proximo.setHours(17, 0, 0, 0);
        const restante = proximo - ahora;
        const horas = Math.floor(restante / (1000 * 60 * 60));
        const mins = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));
        bloqueoDiv.textContent = `‚õî Podr√°s enviar quinielas dentro de ${horas}h ${mins}min.`;
        contadorDiv.textContent = "Estado: ‚ùå Bloqueado";
        btnGuardar.disabled = true;
        btnGuardar.style.background = '#ccc';
        btnGuardar.style.cursor = 'not-allowed';
      } else {
        // Calcular cu√°nto falta para bloquear (viernes 5pm)
        const viernes = new Date();
        viernes.setDate(viernes.getDate() + ((5 - dia + 7) % 7));
        viernes.setHours(17, 0, 0, 0);
        const restante = viernes - ahora;
        const horas = Math.floor(restante / (1000 * 60 * 60));
        const mins = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));
        contadorDiv.textContent = `Estado: ‚úÖ Habilitado ‚Äî tiempo restante: ${horas}h ${mins}min.`;
        bloqueoDiv.textContent = "";
        btnGuardar.disabled = false;
        btnGuardar.style.background = '#004aad';
        btnGuardar.style.cursor = 'pointer';
      }
    }

    actualizarContadores();
    setInterval(actualizarContadores, 60000);

    window.guardarQuiniela = async function () {
      const user = localStorage.getItem("user");
      if (!user) {
        alert("Debes iniciar sesi√≥n");
        return;
      }

      const quiniela = {};
      let incompletos = false;

      partidos.forEach((p, i) => {
        const resultado = document.querySelector(`input[name="partido${i}"]:checked`);
        if (!resultado) incompletos = true;
        quiniela[`partido${i}`] = resultado ? resultado.value : null;
      });

      if (incompletos && !confirm("Hay partidos sin seleccionar. ¬øDeseas guardar as√≠?")) return;

      try {
        await setDoc(doc(db, "quinielas", user), {
          usuario: user,
          quiniela,
          timestamp: Date.now()
        });
        alert("¬°Quiniela guardada con √©xito!");
      } catch (e) {
        alert("Error al guardar la quiniela: " + e.message);
      }
    };
  </script>
</body>
</html>