<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Quiniela - Liga MX</title>
  <link rel="icon" href="imagenes/logo1.png" type="image/png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik&display=swap">
  <style>
    body {
      margin: 0;
      font-family: 'Rubik', sans-serif;
      background: #f2f2f2;
      color: #333;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      color: #004aad;
      margin-bottom: 0.5rem;
    }
    .logo {
      display: block;
      margin: 0 auto 0.5rem;
      width: 80px;
    }
    #contador-tiempo {
      text-align: center;
      font-weight: bold;
      font-size: 1rem;
      color: #004aad;
      margin-bottom: 1rem;
    }
    .partido {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .equipos {
      display: flex;
      justify-content: space-around;
      width: 100%;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .equipo {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 30%;
    }
    .equipo img {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }
    .vs {
      font-size: 1.2rem;
      font-weight: bold;
    }
    .opciones {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }
    .opciones label {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      background: #e9e9e9;
      margin: 0.3rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .opciones input[type="radio"] {
      display: none;
    }
    .opciones input[type="radio"]:checked + label {
      background: #004aad;
      color: white;
      font-weight: bold;
    }
    button {
      width: 100%;
      padding: 1rem;
      background: #004aad;
      color: white;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      margin-top: 1rem;
      cursor: pointer;
    }
    button:hover {
      background: #00327a;
    }
    #bloqueo {
      text-align: center;
      color: red;
      font-weight: bold;
      margin: 0.5rem 0 1rem;
    }
    .pago-section {
      background: #ffffff;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
      margin-top: 1rem;
    }
    .pago-section p {
      margin: 0.5rem 0;
    }
    .pago-section a {
      display: inline-block;
      background: #28a745;
      color: white;
      text-decoration: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      margin: 0.5rem;
    }
    .pago-section a:hover {
      background: #1e7e34;
    }
    .pago-info {
      background: #fff3cd;
      padding: 0.7rem;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      margin-top: 0.7rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <img src="imagenes/logo1.png" alt="Logo" class="logo">
  <h1>Rellena Tu Quiniela üìù</h1>
  <h2 id="numero-jornada" style="text-align:center; color:#555; margin-top: 0;">Jornada: ...</h2>
  <h3 style="text-align:center; color:#555; margin-top: 0;">SOLO PUEDES ENVIAR UNA QUINIELA POR USUARIO!!</h3>
  <h4 style="text-align:center; color:#555; margin-top: 0;">Para enviar mas de 1 quiniela crea otro usuario.</h4>

  <div id="contador-tiempo"></div>
  <div id="bloqueo"></div>

  
  <form id="quiniela-form"></form>

  <button id="btn-guardar" onclick="guardarQuiniela()">Guardar Quiniela</button>
  <button onclick="window.location.href='menu.html'">‚¨ÖÔ∏è Regresar al men√∫</button>

  <div class="pago-section">
    <p>üí∞ <strong>La quiniela cuesta $100 cada una.</strong></p>
    <a href="https://maps.app.goo.gl/JSmoaiYQQLTCYzdJ7?g_st=aw" target="_blank">Pagar en efectivo (ver ubicaci√≥n)</a>
    <div class="pago-info">
      Clave: 722969010705714482<br>
      Banco: STP<br>
      Nombre: Julio Cesar Santos
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBky5T7wDukelYg3Giq_pXc4oveyfHN7go",
      authDomain: "rifaboletos-c1d0d.firebaseapp.com",
      projectId: "rifaboletos-c1d0d",
      storageBucket: "rifaboletos-c1d0d.appspot.com",
      messagingSenderId: "27051588350",
      appId: "1:27051588350:web:74559bf1d4fd5a67f603af"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("quiniela-form");
    const bloqueoDiv = document.getElementById("bloqueo");
    const contadorDiv = document.getElementById("contador-tiempo");
    const btnGuardar = document.getElementById("btn-guardar");

    async function cargarPartidos() {
      const docRef = doc(db, "config", "partidos");
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        form.innerHTML = "<p>No se encontraron partidos configurados.</p>";
        btnGuardar.disabled = true;
        return;
      }

      const data = docSnap.data();
      const partidos = data.partidos || [];
      if (data.jornada) {
  document.getElementById("numero-jornada").textContent = `Jornada: ${data.jornada}`;

      form.innerHTML = "";

      partidos.forEach((p, i) => {
        // Formatear nombre para imagen y texto (min√∫sculas y guiones)
        const equipoLocal = p.equipo1.toLowerCase().replace(/\s+/g, '-');
        const equipoVisitante = p.equipo2.toLowerCase().replace(/\s+/g, '-');

        form.innerHTML += `
          <div class="partido">
            <div class="equipos">
              <div class="equipo">
                <img src="imagenes/${equipoLocal}.png" alt="${equipoLocal}" />
                <span>${p.equipo1.toUpperCase()}</span>
              </div>
              <div class="vs">vs</div>
              <div class="equipo">
                <img src="imagenes/${equipoVisitante}.png" alt="${equipoVisitante}" />
                <span>${p.equipo2.toUpperCase()}</span>
              </div>
            </div>
            <div class="opciones">
              <input type="radio" name="partido${i}" id="local${i}" value="local" />
              <label for="local${i}">Gana ${p.equipo1.toUpperCase()}</label>

              <input type="radio" name="partido${i}" id="empate${i}" value="empate" />
              <label for="empate${i}">Empate</label>

              <input type="radio" name="partido${i}" id="visitante${i}" value="visitante" />
              <label for="visitante${i}">Gana ${p.equipo2.toUpperCase()}</label>
            </div>
          </div>
        `;
      });
    }
}
    function actualizarContadores() {
      const ahora = new Date();
      const dia = ahora.getDay();
      const hora = ahora.getHours();

      // Condici√≥n bloqueo: Viernes desde 18h, s√°bado, domingo y lunes antes de 17h
const bloqueado = (
  (dia === 5 && hora >= 18) || dia === 6 || dia === 0 || (dia === 1 && hora < 17)
);

if (bloqueado) {
  let proximo = new Date();
  if (dia === 5 && hora >= 18) proximo.setDate(proximo.getDate() + 3);
  else if (dia === 6) proximo.setDate(proximo.getDate() + 2);
  else if (dia === 0) proximo.setDate(proximo.getDate() + 1);
  else if (dia === 1) proximo.setHours(17, 0, 0, 0);

  proximo.setHours(17, 0, 0, 0);

  const restante = proximo - ahora;
  const horas = Math.floor(restante / (1000 * 60 * 60));
  const mins = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));

  bloqueoDiv.textContent = `‚õî Podr√°s enviar quinielas dentro de ${horas}h ${mins}min.`;
  contadorDiv.textContent = "Estado: ‚ùå Bloqueado";
  btnGuardar.disabled = true;
  btnGuardar.style.background = '#ccc';
  btnGuardar.style.cursor = 'not-allowed';
} else {
  // Pr√≥ximo bloqueo: viernes 18h
  const viernes = new Date();
  viernes.setDate(viernes.getDate() + ((5 - dia + 7) % 7));
  viernes.setHours(18, 0, 0, 0);
  const restante = viernes - ahora;
  const horas = Math.floor(restante / (1000 * 60 * 60));
  const mins = Math.floor((restante % (1000 * 60 * 60)) / (1000 * 60));
  contadorDiv.textContent = `Estado: ‚úÖ Habilitado ‚Äî tiempo restante: ${horas}h ${mins}min.`;
  bloqueoDiv.textContent = "";
  btnGuardar.disabled = false;
  btnGuardar.style.background = '#004aad';
  btnGuardar.style.cursor = 'pointer';
}
}

window.guardarQuiniela = async function () {
  const user = localStorage.getItem("user");
  if (!user) {
    alert("Debes iniciar sesi√≥n");
    return;
  }

  const quiniela = {};
  let incompletos = false;

      // Guardar las selecciones de cada partido
      const radios = form.querySelectorAll('input[type="radio"]:checked');
      const partidosCount = form.querySelectorAll('.partido').length;

      for (let i = 0; i < partidosCount; i++) {
        const seleccionado = form.querySelector(`input[name="partido${i}"]:checked`);
        if (!seleccionado) incompletos = true;
        quiniela[`partido${i}`] = seleccionado ? seleccionado.value : null;
      }

      if (incompletos && !confirm("Hay partidos sin seleccionar. ¬øDeseas guardar as√≠?")) return;

      try {
        await setDoc(doc(db, "quinielas", user), {
          usuario: user,
          quiniela,
          timestamp: Date.now()
        });
        alert("¬°Quiniela guardada con √©xito!");
      } catch (e) {
        alert("Error al guardar la quiniela: " + e.message);
      }
    };

    // Carga los partidos al inicio
    cargarPartidos();
    actualizarContadores();
    setInterval(actualizarContadores, 60000);
  </script>
</body>
</html>
